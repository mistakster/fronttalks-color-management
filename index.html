<!DOCTYPE html>
<html lang="en">
<head>
    <title>Shower Presentation Engine</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="shower/themes/material/styles/styles.css">
    <style>
        /*
        .shower {
            --slide-ratio: calc(16 / 9);
        }
        */
        .b {
            display: block;
        }

        .c {
            color: var(--color-medium);
        }
    </style>
</head>
<body class="shower list">

<header class="caption">
    <h1>Два плагина к PostCSS для управления цветом</h1>
    <p>Владимир Кузнецов, Хантфлоу</p>
</header>

<section class="slide">
    <h2>PostCSS бесполезен без плагинов</h2>
</section>

<section class="slide">
    <p>I decided to implement my own cool plugin.</p>

    <p><a href="https://github.com/mistakster/postcss-unwrap-at-media">postcss-unwrap-at-media</a></p>
</section>

<section class="slide">
    <h2 class="shout">
        <span class="b">Abstract</span>
        <span class="b">Syntax</span>
        <span class="b">Trees</span>
    </h2>
</section>

<section class="slide">
    <h2><a href="https://astexplorer.net">AST Explorer</a></h2>
</section>

<section class="slide">
    <p>Может оказаться, что существующий плагин решает задачу, но не так как вам хотелось бы.</p>

    <p>Что делать?</p>

    <ul>
        <li>отрицание</li>
        <li>гнев</li>
        <li>торги</li>
        <li>депрессия</li>
        <li>принятие</li>
    </ul>
</section>

<section class="slide">
    <p>Может оказаться, что существующий плагин решает задачу, но не так как вам хотелось бы.</p>

    <p>Что делать?</p>

    <ul>
        <li>смириться</li>
        <li>сделать PR в плагин</li>
        <li>написать свой плагин</li>
    </ul>
</section>

<section class="slide">
    <p>James Steinbach</p>
    <p><a href="https://dockyard.com/blog/2018/02/01/writing-your-first-postcss-plugin">
        Writing Your First PostCSS Plugin
    </a></p>
</section>

<section class="slide">
    <h2>Обход дерева</h2>
    <p>Типы узлов</p>
    <ul>
        <li>rule (div, .list)</li>
        <li>declaration (color, background)</li>
        <li>@rule (media, charset)</li>
        <li>comment</li>
    </ul>
</section>

<section class="slide">
    <h2 class="shout">Тестирование</h2>
</section>

<section class="slide">
    <h2 class="shout">postcss-alter-color</h2>
</section>

<section class="slide">
    <pre><code>{ from: 'darkslategray', to: '#556832' }</code></pre>

    <pre><code>p { color: darkslategray; }
a { color: #2F4F4F; }
.quote {
  border-left: 1px solid rgb(47, 79, 79);
  border-right: solid hsl(180, 25%, 25%) 1px;
}</code></pre>
</section>

<section class="slide">
    <pre><code>{ from: 'darkslategray', to: '#556832' }</code></pre>

    <pre><code>p { color: <mark>darkslategray</mark>; }
a { color: <mark>#2F4F4F</mark>; }
.quote {
  border-left: 1px solid <mark>rgb(47, 79, 79)</mark>;
  border-right: solid <mark>hsl(180, 25%, 25%)</mark> 1px;
}</code></pre>
</section>

<section class="slide">
    <pre><code>{ from: 'darkslategray', to: '#556832' }</code></pre>

    <pre><code>p { color: <mark>#556832</mark>; }
a { color: <mark>#556832</mark>; }
.quote {
  border-left: 1px solid <mark>#556832</mark>;
  border-right: solid <mark>#556832</mark> 1px;
}</code></pre>
</section>

<section class="slide">
    <pre>
        <code>function plugin(options) {</code>
        <code>  return function(root) {</code>
        <code>    if (decl.value === options.from) {</code>
        <code>      decl.value = options.to;</code>
        <code>    }</code>
        <code>  };</code>
        <code>}</code>
        <code>module.exports = postcss.plugin('alter-color', plugin);</code>
    </pre>
</section>

<section class="slide">
    <h2>Варианты записи цвета</h2>
    <div class="columns two">
        <div>
            <p>Сплошные цвета</p>
            <ul>
                <li>white</li>
                <li>#333</li>
                <li>#556832</li>
                <li>rgb(47, 79, 79)</li>
                <li>hsl(180, 25%, 25%)</li>
            </ul>
        </div>
        <div class="next">
            <p>Цвета с прозрачностью</p>
            <ul>
                <li>rgba(47, 79, 79, 0.5)</li>
                <li>hsla(180, 25%, 25%, 0.5)</li>
                <li>#3338</li>
                <li>#55683280</li>
            </ul>
        </div>
    </div>
</section>

<section class="slide">
    <h2>Сравниваем цвета в различных записях</h2>

    <p>parse-color</p>
</section>

<section class="slide">
    <h2>Разбор значения узла decl</h2>
    <pre><code>#main { border: 1px solid: #333 }</code></pre>
    <pre><code>decl {
  props: "border",
  value: "1px solid #333"
}</code></pre>
</section>

<section class="slide">
    <h2 class="shout">CSSTree</h2>
</section>

<section class="slide">
    <pre>
        <code>root.walkDecls(decl => {</code>
        <code>  const parsedValue = cssTree.parse(</code>
        <code>    decl.value,</code>
        <code>    { context: 'value' }</code>
        <code>  );</code>
        <code>  // тут можно изменить parsedValue</code>
        <code>  decl.value = cssTree.generate(parsedValue);</code>
        <code>});</code>
    </pre>
</section>

<section class="slide">
    <pre><code>"1px solid #333"</code></pre>

    <pre>
        <code>{ type: "Value", children: [</code>
        <code>  { type: "Dimension", value: 1, unit: "px" },</code>
        <code>  { type: "WhiteSpace", value: " " },</code>
        <code>  { type: "Identifier", name: "solid" },</code>
        <code>  { type: "WhiteSpace", value: " " },</code>
        <code>  { type: "HexColor", value: "333" }</code>
        <code>] }</code>
    </pre>
</section>

<section class="slide">
    <pre><code>"darkslategray"</code></pre>

    <pre>
        <code>{ type: "Value", children: [</code>
        <code>  { type: "Identifier", name: "darkslategray" }</code>
        <code>] }</code>
    </pre>
</section>

<section class="slide">
    <pre><code>rgb(31, 31, 31)</code></pre>
    <pre>
        <code>{ type: "Value", children: [</code>
        <code>  { type: "Function", name: "rgb", "children": [</code>
        <code>  { type: "Number", value: "31"},</code>
        <code>  { type: "Operator", value: ","},</code>
        <code>  { type: "Number", value: "31"},</code>
        <code>  { type: "Operator", value: ","},</code>
        <code>  { type: "Number", value: "31"}</code>
        <code>  ] }</code>
        <code>] }</code>
    </pre>
</section>

<section class="slide">
    <ul>
        <li>Identifier <span class="c">darkslategray</span></li>
        <li>HexColor <span class="c">#2F4F4F</span></li>
        <li>Function <span class="c">rgb(47, 79, 79)</span></li>
    </ul>
</section>

<section class="slide">
    <pre>
        <code>cssTree.walk(parsedValue, {</code>
        <code>  visit: 'Identifier',</code>
        <code>  <mark>enter</mark>: (node, item, list) => {</code>
        <code>    // изменяем node</code>
        <code>  }</code>
        <code>});</code>
    </pre>
</section>

<section class="slide">
    <pre>
        <code><mark>enter</mark>: (node, item, list) => {</code>
        <code>  const data = cssTree.fromPlainObject({</code>
        <code>    type: 'HexColor',</code>
        <code>    value: replaceValue(node)</code>
        <code>  });</code>
        <code>  list.replace(item, list.createItem(data));</code>
        <code>}</code>
    </pre>
</section>

<section class="slide">
    <h2>rgb(), rgba(), hsl() и hsla()</h2>
    <p>Цветовые функции содержат вложенную структуру</p>
    <p>Каждый цветовой компонен нужно сравнивать отдельно</p>
</section>

<section class="slide">
    <h2><a href="https://github.com/mistakster/postcss-alter-color">postcss-alter-color</a></h2>
    <p>Плагин, который делает больше, чем просто поиск и замена в текстовом редакторе</p>
</section>

<section class="slide">
    <h2><a href="https://github.com/mistakster/postcss-themes-generator">postcss-themes-generator</a></h2>
</section>

<section class="slide">
    <p>We have a set of independent components or widgets. Following the BEM naming convention,
        they are blocks. Every color comes from a predefined palette. All looks good.</p>
</section>

<section class="slide">
    <p>The client wants to have 4 independent sites (“main”, “student portal”, “international” and “business”)</p>
</section>

<section class="slide">
    <ul>
        <li>CSS custom properties;</li>
        <li>preprocessor variables and generate 4 different CSS files;</li>
        <li>PostCSS to generate required styles.</li>
    </ul>
</section>

<section class="slide">
    <h2></h2>
    <ul>
        <li>We write CSS, as usual, assume it’s for the main site.</li>
        <li>We use “primary”, “secondary” and “accent” modifiers to set background color or color of the decoration.
            That’s the only point where colors are changing.</li>
        <li>PostCSS plugin inserts additional rules if it matches modifier and target color.</li>
    </ul>
</section>

<section class="slide">
    <pre><code>[ { "name": "primary",
  "match": "#e54096",
  "themes": {
    "portal": "#0080c5",
    "business": "#c1d730",
    "international": "#e5352d"
  }
}, { name: "secondary", &hellip; } ]</code></pre>
</section>

<section class="slide">
    <pre><code>.tile_primary { color: #e54096 }
.theme-portal .tile_primary { color: #0080c5 }
.theme-business .tile_primary { color: #c1d730 }
.theme-international .tile_primary { color: #e5352d }
</code></pre>
</section>

<section class="slide">
    <pre><code>.tile__badge_<mark>primary</mark>:hover {
  background-color: #e54096;
}
.tile_<mark>primary</mark> .text-tile__heading {
  color: #e54096;
}
</code></pre>
</section>

<section class="slide">
    <pre>
        <code>const themedRule = rule.clone();</code>
        <code>themedRule.selectors = themedRule.selectors</code>
        <code>  .map(selector => `.theme-${themeName} ${selector}`);</code>
        <code>themedRule.walkDecls(decl => {</code>
        <code>  // меняем decl.value, если это требуется</code>
        <code>});</code>
    </pre>
</section>

<section class="slide">
    <h2>Подозрительное правило</h2>
    <p>Модификатор есть, а изменить ничего нельзя</p>
    <pre><code>rule.warn(result, 'Suspicious rule');</code></pre>
</section>

<section class="slide">
    <h2>Светлые и тёмные цвета</h2>
    <p>В цветовом пространстве HSL компоненты hue и saturation будут без изменений,
    а разницу значений компоненты lightness нужно доабвить к цвету темы</p>
</section>

<section class="slide">
    Плагин позволил команде поддерживать чистый и компактный CSS
</section>

<footer class="badge">
    <a href="https://github.com/shower/shower">Fork me on GitHub</a>
</footer>

<div class="progress"></div>

<script src="shower/shower.min.js"></script>

</body>
</html>
